(()=>{"use strict";const e="f0312cfa-6c00-4b71-84b6-534ea2e1bdff";async function n(n,o){const s=n+o,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":`${e}`}});!function(e,n){const o=document.querySelector(".movies");document.querySelector(".movies").innerHTML="",e.films.forEach((e=>{const n=document.createElement("div");n.classList.add("movie"),n.innerHTML=`\n        <a href = "view.html?id=${e.filmId}">\n            <div class="movie__cover-inner">\n                <img class="movie__cover" src="${e.posterUrlPreview}" alt ="${e.nameRu}">\n                <div class="movie__cover--darkened"></div> \n            </div>\n        </a>\n            <div class="movie__info">\n                <div class="movie__title">${e.nameRu}</div>\n                <div class="movie__category">${e.genres.map((e=>` ${e.genre}`))}</div>\n                <div class="movie__rating movie__rating--${i(e.rating)}">${t(e.rating)}</div>\n            </div>\n    `,o.append(n)}))}(await a.json())}function t(e){const n=e+"";return-1!=n.indexOf("%")?(parseInt(n)/10).toFixed(1):"null"==n?"":n}function i(e){const n=+t(e);return n>=7?"green":n>4?"orange":n?"red":"white"}const o=document.location.search.slice(4);function s(e){let n=e;return n=n>10?(n/10).toFixed(2):n,+n}function a(e){const n=+s(e);return n>=7?"green":n>4?"orange":n?"red":"white"}async function c(n,o,s,a){const c=`https://kinopoiskapiunofficial.tech/api/v2.2/films?countries=${n}&genres=${o}&order=RATING&type=ALL&ratingFrom=0&ratingTo=10&yearFrom=${s}&yearTo=${a}&page=1`,d=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":`${e}`}}),l=await d.json();console.log(l),function(e,n){const o=document.querySelector(".movies");document.querySelector(".movies").innerHTML="",e.items.forEach((e=>{const n=document.createElement("div");n.classList.add("movie"),n.innerHTML=`\n        <a href = "view.html?id=${e.kinopoiskId}">\n            <div class="movie__cover-inner">\n                <img class="movie__cover" src="${e.posterUrlPreview}" alt ="${e.nameRu}">\n                <div class="movie__cover--darkened"></div> \n            </div>\n        </a>\n            <div class="movie__info">\n                <div class="movie__title">${e.nameRu}</div>\n                <div class="movie__category">${e.genres.map((e=>` ${e.genre}`))}</div>\n                <div class="movie__rating movie__rating--${i(e.ratingKinopoisk)}">${t(e.ratingKinopoisk)}</div>\n            </div>\n    `,o.append(n)}))}(l)}function d(){this.dataset.close?this.dataset.close&&(this.children[1].classList.remove("open"),this.dataset.close=""):(this.children[1].classList.add("open"),this.dataset.close=!0)}function l(e){const n=function(e){const n=document.createElement("div");return n.style.width=`${e.width}`,n.classList.add("modal"),n.innerHTML=`\n        \n            <div class="modal-overlay" data-close = "true">\n                <div class="modal-window" style = "width:${e.width||"600"}px">\n                <div class = "modal-container ${e.modalStyle}">\n                    <div class="modal-header ${e.modalStyle}">\n                        <h3 class="modal-title">${e.title||""}</h3>\n                        ${e.subtitle&&`<span class="modal-subtitle">${e.subtitle}</span>`||""}\n                        ${e.closable?'<span class="modal-close" data-close = "true">&times</span>':""}\n                    </div>\n                    <div class="modal-body ${e.modalStyle}">\n                        ${e.content||""}\n                    </div>\n                    <div class="modal-footer">\n                        ${e.footer}\n                    </div>\n                </div>\n            </div>\n        </div>`,document.body.appendChild(n),n}(e);let t=!1,i=!1;const o={open(){if(i)return console.log("modal is destroyed");!t&&n.classList.add("open")},close(){t=!0,n.classList.remove("open"),n.classList.add("hide"),setTimeout((()=>{n.classList.remove("hide"),t=!1}),500)}},s=e=>{e.target.dataset.close&&(o.close(),o.destroy())};return n.addEventListener("click",s),Object.assign(o,{destroy(){n.parentNode.removeChild(n),n.removeEventListener("click",s),i=!0}})}var r,m;-1!=document.location.pathname.indexOf("view")&&async function(n){const t=`https://kinopoiskapiunofficial.tech/api/v2.2/films/${n}`,i=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":`${e}`}});(function(e,n){const t=document.querySelector(`.${n}`);document.querySelector(`.${n}`).innerHTML="";const i=document.createElement("div");i.classList.add("movie-description"),i.innerHTML=`\n        <h1 class="movie-description__title">${e.nameRu}</h1>\n        <h2 class="movie-description__title en">${e.nameOriginal||""}</h2>\n        <div class="video-info">\n            <span class="video-info__year">${e.year},</span>\n            <span class="video-info__genres">${e.genres.map((e=>` ${e.genre}`))},</span>\n            <span class="video-info__country">${e.countries[0].country}</span>\n         </div>\n        <div class="movie-description__time">Время: ${e.filmLength||"110"} минут</div>\n        <div class="movie-description__rating">Ожидаемый рейтинг:<span class="movie-description__rating--${a(e.ratingAwait)}"> ${s(e.ratingAwait)||""}</span></div> \n        <div class="movie-description__rating">Рейтинг:<span class="movie-description__rating--${a(e.ratingKinopoisk)}"> ${e.ratingKinopoisk||""}</span></div>\n        <div class="movie-description__description"> ${e.description}\n        </div>\n    `,t.append(i)})(await i.json(),"movie-content-inner"),async function(n){const t=`https://kinopoiskapiunofficial.tech/api/v2.2/films/${n}/similars`,i=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json","X-API-KEY":`${e}`}});!function(e,n){const t=document.querySelector(`.${n}`);document.querySelector(`.${n}`).innerHTML="",e.items.forEach((e=>{const n=document.createElement("div");n.classList.add("movie"),n.innerHTML=`\n        <a href = "view.html?id=${e.filmId}">\n            <div class="movie__cover-inner">\n                <img class="movie__cover" src="${e.posterUrlPreview}" alt ="${e.nameRu}">\n                <div class="movie__cover--darkened"></div> \n            </div>\n        </a>\n            <div class="movie__info">\n                <div class="movie__title">${e.nameRu}</div>\n            </div>\n    `,t.append(n)}))}(await i.json(),"movieRecomended__content")}(n)}(o),r=function(e){let n=!0===e?"webp":"no-webp";document.documentElement.classList.add(n)},(m=new Image).onload=m.onerror=function(){r(2==m.height)},m.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";const v="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page=";document.querySelector(".main-title")&&n(v,1);const u=document.querySelector("form"),p=document.querySelector(".header__search");u.addEventListener("submit",(e=>{e.preventDefault();const t=`https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=${p.value}`;p.value&&(n(t,1),p.value="")}));const h=document.querySelectorAll(".pageNumber");for(let e of h)e.addEventListener("click",(()=>{let t=e.firstElementChild.innerHTML;h.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),n(v,t)}));const f={width:"380",title:"Вход",subtitle:"Регистрация",borderHeader:!0,closable:!0,modalStyle:"small-window",content:'\n    <div class = "auth-info"> Для входа введите email или номер телефона </div> \n    <form> <input class = "auth-input" type = "text" placeholder = "Номер телефона" tabindex = "1"> </form> \n    <form> <input class= "auth-input" type="text" placeholder = "Пароль" tabindex = "2"> </form>\n    <div class = "auth-form-remember"> \n    <label><input type = "checkbox" checked = "checked" tabindex = "3"> Запомнить меня </label>\n    </div>\n    ',footer:'<div class = "form-action"> <button class = "btn" tabindex = "4"> Войти</button></div>'};document.querySelector(".header__auth-link").addEventListener("click",(()=>{const e=l(f);e.open(),document.querySelector(".modal-subtitle").addEventListener("click",(()=>{const n=l(_);e.destroy(),n.open()}))}));const _={width:"380",title:"Регистрация",subtitle:"",borderHeader:!0,closable:!0,modalStyle:"small-window",content:'\n    <div class = "auth-info"> Для регистрации введите ваш номер телефона и пароль</div> \n    <form> <input class = "auth-input" type = "text" placeholder = "Номер телефона" tabindex = "1"> </form> \n    <form> <input class= "auth-input" type="text" placeholder = "Пароль" tabindex = "2"> </form>\n    <div class = "auth-rules"> Нажимая кнопку "Зарегистрироваться" вы принимаете условия <a href = "#">Пользовательского \n    соглашения и Политики обработки персональных данных </a>\n    </div>\n    ',footer:'<div class = "form-action"> <button class = "btn" tabindex = "4"> Зарегистрироваться </button></div>'},y=document.querySelectorAll(".nav-item");let g="",$="",b="",L="";for(let e=0;e<y.length;e++){y[e].addEventListener("click",d);for(let n=0;n<y[e].lastElementChild.children.length;n++)y[e].lastElementChild.children[n].addEventListener("click",(()=>{const t=y[e].lastElementChild.children[n].firstElementChild;t.dataset.genre&&(g=t.dataset.genre,console.log(g)),t.dataset.startyear&&t.dataset.endyear&&(b=t.dataset.startyear,L=t.dataset.endyear,console.log(b),console.log(L)),t.dataset.country&&($=t.dataset.country,console.log($)),c($,g,b,L)}))}})();